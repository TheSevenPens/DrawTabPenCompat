<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SevenPens Wacom Tablet/Pen Compatibility</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>SevenPens Wacom Tablet/Pen Compatibility (Partial)</h1>

    <div class="controls">
        <p>Loading <code>wacom-pen-compat.xml</code>...</p>
        <div id="options-area" style="display:none; margin-bottom: 5px;">
            <input type="checkbox" id="show-names" checked>
            <label for="show-names" style="margin-right: 15px;">Show names</label>
            <input type="checkbox" id="one-per-line">
            <label for="one-per-line">One per line</label>
            <label for="view-mode-select"
                style="margin-left: 15px; border-left: 1px solid #ccc; padding-left: 15px;">View:</label>
            <select id="view-mode-select" style="margin-left: 5px; padding: 4px;">
                <option value="grouped">Compact Grouped</option>
                <option value="by-tablet">Group by tablet</option>
                <option value="by-pen">Group by pen</option>
                <option value="ungrouped">Ungrouped</option>
            </select>
        </div>
        <div id="search-area" style="display:none; margin-top: 10px;">
            <input type="text" id="search-input" placeholder="Search devices..."
                style="width: 100%; max-width: 400px; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;">
        </div>
    </div>
    <p id="error-msg"></p>
    <div id="stats-bar" class="stats-bar">Loading stats...</div>
    </div>

    <table id="compat-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Tablets</th>
                <th>Pens</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be populated here -->
        </tbody>
    </table>

    <script src="xml-loader.js"></script>
    <script src="table-renderer.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tableBody = document.querySelector('#compat-table tbody');
            const showNamesCheckbox = document.getElementById('show-names');
            const onePerLineCheckbox = document.getElementById('one-per-line');
            const searchInput = document.getElementById('search-input');
            const optionsArea = document.getElementById('options-area');
            const searchArea = document.getElementById('search-area');
            const errorMsg = document.getElementById('error-msg');

            let compatibilityRows = [];
            let tabletDefs = new Map();
            let penDefs = new Map();

            const updateTable = () => renderCompatTable(tableBody, compatibilityRows, tabletDefs, penDefs);

            showNamesCheckbox.addEventListener('change', updateTable);
            onePerLineCheckbox.addEventListener('change', updateTable);
            document.getElementById('view-mode-select').addEventListener('change', updateTable);
            searchInput.addEventListener('input', updateTable);

            // Try to fetch automatically
            fetchAndParseXML('wacom-pen-compat.xml')
                .then(data => {
                    compatibilityRows = data.rows;
                    tabletDefs = data.tabletDefs;
                    penDefs = data.penDefs;
                    updateTable();
                    document.querySelector('.controls p').style.display = 'none'; // Hide loading text
                    optionsArea.style.display = 'block';
                    searchArea.style.display = 'block';
                })
                .catch(err => {
                    console.error('Auto-load failed:', err);
                    document.querySelector('.controls p').style.display = 'none';
                    showError("Failed to load compatibility data: " + err.message);
                });

            // Handle manual file selection


            function showError(msg) {
                errorMsg.textContent = msg;
                errorMsg.style.display = 'block';
            }
        });
    </script>
</body>

</html>